# Fix-Windows-Patches.ps1
# Grupo: Windows OS Vulnerabilities
# CVEs: CVE-2024-21386, CVE-2022-24512, CVE-2021-26701, CVE-2022-30184 (Follina)

$isAdmin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole("Administrators")
if (-not $isAdmin) {
    Write-Host "‚ö†Ô∏è  Ejecuta como Administrador." -ForegroundColor Red; exit 1
}

Write-Host "`nüîç Buscando actualizaciones de Windows..." -ForegroundColor Cyan

try {
    $session = New-Object -ComObject Microsoft.Update.Session
    $searcher = $session.CreateUpdateSearcher()
    $result = $searcher.Search("IsInstalled=0 and Type='Software'")

    if ($result.Updates.Count -eq 0) {
        Write-Host "‚úÖ Sistema actualizado. No hay parches pendientes." -ForegroundColor Green
    } else {
        Write-Host "‚ö†Ô∏è  $($_.Updates.Count) actualizaciones disponibles:" -ForegroundColor Yellow
        for ($i = 0; $i -lt $result.Updates.Count; $i++) {
            Write-Host "  $($result.Updates.Item($i).Title)"
        }
        Write-Host "`nüí° Recomendaci√≥n: Instalar desde Windows Update o WSUS."
    }
} catch {
    Write-Error "‚ùå Error al buscar actualizaciones: $($_.Exception.Message)"
}
