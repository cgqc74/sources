# Set this to the path where your Java application's libraries are stored
$ProjectLibFolder = "C:\path\to\your\project\lib"

# Define the new secure version
$SecureVersion = "1.6.0"
$ShiroJarName = "shiro-core"
$DownloadUrl = "https://repo1.maven.org/maven2/org/apache/shiro/shiro-core/1.6.0/shiro-core-1.6.0.jar"
$NewJarPath = Join-Path $ProjectLibFolder "shiro-core-1.6.0.jar"

# Find all shiro-core JARs in the lib folder
$OldJars = Get-ChildItem -Path $ProjectLibFolder -Filter "shiro-core-*.jar"

$Updated = $false
foreach ($jar in $OldJars) {
    if ($jar.Name -ne "shiro-core-$SecureVersion.jar") {
        Write-Host "Found insecure Shiro JAR: $($jar.Name). Backing up and replacing..."
        Rename-Item -Path $jar.FullName -NewName ($jar.Name + ".bak")
        $Updated = $true
    }
}

# Download the secure jar if needed
if ($Updated -and !(Test-Path $NewJarPath)) {
    Write-Host "Downloading Apache Shiro $SecureVersion..."
    Invoke-WebRequest -Uri $DownloadUrl -OutFile $NewJarPath
    Write-Host "Downloaded and replaced with $NewJarPath"
} elseif (Test-Path $NewJarPath) {
    Write-Host "Secure Shiro JAR ($SecureVersion) already present."
} else {
    Write-Host "No insecure Shiro JARs found. No changes made."
}
