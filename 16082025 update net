# Función para verificar la versión instalada de .NET Core
function Get-DotNetVersion {
    $dotnetPath = "C:\Program Files\dotnet\dotnet.exe"
    if (Test-Path $dotnetPath) {
        $version = & $dotnetPath --version
        return $version
    } else {
        Write-Host ".NET Core no está instalado."
        return $null
    }
}

# Función para verificar la versión instalada de PowerShell Core
function Get-PowerShellVersion {
    $psPath = "C:\Program Files\PowerShell\7\pwsh.exe"
    if (Test-Path $psPath) {
        $version = & $psPath --version
        return $version
    } else {
        Write-Host "PowerShell Core no está instalado."
        return $null
    }
}

# Función para descargar e instalar .NET Core
function Install-DotNet {
    $url = "https://dotnet.microsoft.com/es-es/download/dotnet/thank-you/sdk-3.1.426-windows-x64-installer"
	
    $installer = "dotnet-sdk-3.1.115-win-x64.exe"
    Invoke-WebRequest -Uri $url -OutFile $installer
    Start-Process -FilePath $installer -ArgumentList "/quiet" -Wait
    Remove-Item $installer
    Write-Host ".NET Core 3.1.115 instalado."
}

# Función para descargar e instalar PowerShell Core
function Install-PowerShell {
    $url = "https://github.com/PowerShell/PowerShell/releases/download/v7.5.2/PowerShell-7.5.2-win-x64.msi"
	
	
    $installer = "PowerShell-7.5.2-win-x64.msi"
    Invoke-WebRequest -Uri $url -OutFile $installer
    Start-Process -FilePath $installer -ArgumentList "/quiet" -Wait
    Remove-Item $installer
    Write-Host "PowerShell Core 7.1.3 instalado."
}

# Verificar versiones instaladas
$dotnetVersion = Get-DotNetVersion
$psVersion = Get-PowerShellVersion

# Actualizar .NET Core si es necesario
if ($dotnetVersion -lt "3.1.15") {
    Write-Host "Actualizando .NET Core..."
    Install-DotNet
} else {
    Write-Host ".NET Core ya está actualizado."
}

# Actualizar PowerShell Core si es necesario
if ($psVersion -lt "7.1.3") {
    Write-Host "Actualizando PowerShell Core..."
    Install-PowerShell
} else {
    Write-Host "PowerShell Core ya está actualizado."
}
